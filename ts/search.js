(()=>{var d=Object.defineProperty,f=e=>d(e,"__esModule",{value:!0}),w=(e,t)=>()=>(t||(t={exports:{}},e(t.exports,t)),t.exports),T=(e,t)=>{f(e);for(var i in t)d(e,i,{get:t[i],enumerable:!0})},g=w(v=>{T(v,{default:()=>m});const S={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","\u2026":"&hellip;"};function y(e){return S[e]||e}function L(e){return e.replace(/[&<>"]/g,y)}function E(e){return e.replace(/[.*+\-?^${}()|[\]\\]/g,"\\$&")}class s{constructor({form:e,input:t,list:i,resultTitle:a,resultTitleTemplate:r}){this.form=e,this.input=t,this.list=i,this.resultTitle=a,this.resultTitleTemplate=r,this.handleQueryString(),this.bindQueryStringChange(),this.bindSearchForm()}async searchKeywords(e){const t=await this.getData();let i=[];e.sort((a,r)=>r.length-a.length);for(const a of t){let r={...a,preview:"",matchCount:0},p=!1;for(const o of e){if(o==="")continue;const n=new RegExp(E(L(o)),"gi"),c=n.exec(r.content);n.lastIndex=0;const u=n.exec(r.title);if(n.lastIndex=0,u&&(r.title=r.title.replace(n,s.marker)),u||c){p=!0,++r.matchCount;let l=0,h=100;c&&(l=c.index-20,h=c.index+80,l<0&&(l=0)),r.preview.indexOf(o)!==-1?r.preview=r.preview.replace(n,s.marker):(l!==0&&(r.preview+="[...] "),r.preview+=`${r.content.slice(l,h).replace(n,s.marker)} `)}}p&&(r.preview+="[...]",i.push(r))}return i.sort((a,r)=>r.matchCount-a.matchCount)}static marker(e){return"<mark>"+e+"</mark>"}async doSearch(e){const t=performance.now(),i=await this.searchKeywords(e);this.clear();for(const r of i)this.list.append(s.render(r));const a=performance.now();this.resultTitle.innerText=this.generateResultTitle(i.length,((a-t)/1e3).toPrecision(1))}generateResultTitle(e,t){return this.resultTitleTemplate.replace("#PAGES_COUNT",e).replace("#TIME_SECONDS",t)}async getData(){if(!this.data){const e=this.form.dataset.json;this.data=await fetch(e).then(t=>t.json())}return this.data}bindSearchForm(){let e="";const t=i=>{i.preventDefault();const a=this.input.value;if(s.updateQueryString(a,!0),a==="")return this.clear();if(e===a)return;e=a,this.doSearch(a.split(" "))};this.input.addEventListener("input",t),this.input.addEventListener("compositionend",t)}clear(){this.list.innerHTML="",this.resultTitle.innerText=""}bindQueryStringChange(){window.addEventListener("popstate",e=>{this.handleQueryString()})}handleQueryString(){const e=new URL(window.location.toString()),t=e.searchParams.get("keyword");this.input.value=t,t?this.doSearch(t.split(" ")):this.clear()}static updateQueryString(e,t=!1){const i=new URL(window.location.toString());e===""?i.searchParams.delete("keyword"):i.searchParams.set("keyword",e),t?window.history.replaceState("","",i.toString()):window.history.pushState("","",i.toString())}static render(e){return createElement("article",null,createElement("a",{href:e.permalink},createElement("div",{class:"article-details"},createElement("h2",{class:"article-title",dangerouslySetInnerHTML:{__html:e.title}}),createElement("secion",{class:"article-preview",dangerouslySetInnerHTML:{__html:e.preview}})),e.image&&createElement("div",{class:"article-image"},createElement("img",{src:e.image,loading:"lazy"}))))}}window.addEventListener("load",()=>{setTimeout(function(){const e=document.querySelector(".search-form"),t=e.querySelector("input"),i=document.querySelector(".search-result--list"),a=document.querySelector(".search-result--title");new s({form:e,input:t,list:i,resultTitle:a,resultTitleTemplate:window.searchResultTitleTemplate})},0)});var m=s});g();})();
